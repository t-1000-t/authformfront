(self.webpackChunkauthform=self.webpackChunkauthform||[]).push([[878],{3850:(e,l,t)=>{"use strict";t.r(l),t.d(l,{default:()=>D});var n=t(5043),r=t(2107),c=t(6221),s=t(9838),a=t(8846),i=t(5371),o=t(3669),d=t(1929),u=t.n(d),h=t(579);const m=e=>{let{streamRef:l,isOpponent:t}=e;return(0,h.jsx)(u(),{children:(0,h.jsx)(r.a,{h:"136px",w:"136px",rounded:"full",position:"relative",flexShrink:0,overflow:"hidden",bg:"black",mx:2,children:(0,h.jsx)("video",{ref:l,playsInline:!0,muted:!t,autoPlay:!0,style:{maxWidth:"100%",objectFit:"cover",borderRadius:"50%",transform:"translate3d(0, 0, 0)",width:"136px",height:"136px"},children:(0,h.jsx)("track",{kind:"captions"})})})})};var f=t(9301),x=t(8070);const p=e=>{let{receivingCall:l,callAccepted:t,name:n,answerCall:c}=e;return l&&!t?(0,h.jsxs)(r.a,{textAlign:"center",children:[(0,h.jsxs)(a.D,{size:"md",mb:4,children:[n," is calling..."]}),(0,h.jsx)(f.$,{colorScheme:"green",leftIcon:(0,h.jsx)(x.X,{}),onClick:c,children:"Answer"})]}):null};var j=t(6593),g=t.n(j),b=t(3604),k=t(4473);const v=async()=>(await k.Ay.get("/api/users/list")).data;var S=t(7208);const C=function(){const{socket:e,socketId:l}=(0,b.Y)(),[t,r]=(0,n.useState)(""),[c,s]=(0,n.useState)(null),[a,i]=(0,n.useState)(!1),[o,d]=(0,n.useState)(""),[u,h]=(0,n.useState)(null),[m,f]=(0,n.useState)(!1),[x,p]=(0,n.useState)(!1),[j,k]=(0,n.useState)(""),[C,w]=(0,n.useState)([]),E=(0,n.useRef)(null),A=(0,n.useRef)(),U=(0,n.useRef)(),O=(0,n.useCallback)(async()=>{const e=await v();w(e.list||[])},[]);return(0,n.useEffect)(()=>{O().then()},[O]),(0,n.useEffect)(()=>(e.on("callUser",e=>{i(!0),d(e.from),h(e.signal)}),()=>{e.off("callUser")}),[e]),(0,n.useEffect)(()=>{r(l)},[l]),(0,n.useEffect)(()=>{E.current&&c&&(E.current.srcObject=c)},[c]),{me:t,stream:c,receivingCall:a,caller:o,callerSignal:u,callAccepted:m,callEnded:x,name:j,setName:k,listUsers:C,myVideo:E,opponentVideo:A,callUser:l=>{navigator.mediaDevices.getUserMedia({video:!0,audio:!0}).then(n=>{if(!n)return void(0,S.l)("Unable to access your camera and microphone");s(n),f(!0),E.current&&(E.current.srcObject=n);const r=new(g())({initiator:!0,trickle:!1,stream:n});r.on("signal",n=>{e.emit("callUser",{userToCall:l,signalData:n,from:t,name:j})}),r.on("stream",e=>{A.current&&(A.current.srcObject=e)}),r.on("error",e=>(0,S.v)(e)),e.on("callAccepted",e=>{f(!0),r.signal(e)}),U.current=r}).catch(e=>(0,S.v)(e))},answerCall:()=>{navigator.mediaDevices.getUserMedia({video:!0,audio:!0}).then(l=>{if(!l)return void(0,S.l)("Unable to access your camera and microphone");s(l),f(!0),E.current&&(E.current.srcObject=l);const t=new(g())({initiator:!1,trickle:!1,stream:l});t.on("signal",l=>{e.emit("answerCall",{signal:l,to:o})}),t.on("stream",e=>{A.current&&(A.current.srcObject=e)}),t.on("error",e=>(0,S.v)(e)),t.signal(u),U.current=t}).catch(e=>((0,S.v)(e),null))},endCall:()=>{p(!0),c&&c.getTracks().forEach(e=>e.stop()),i(!1),d(""),h(null),f(!1),e.off("callAccepted")}}};var w=t(9379),E=t(202),A=t(9081),U=t(2703),O=t(7575),y=t(7467);const I=n.memo(e=>{let{list:l,callAccepted:t,callEnded:c,callUser:s,endCall:a}=e;const{socket:i,socketId:o}=(0,b.Y)(),[d,u]=(0,n.useState)(l);return(0,n.useEffect)(()=>{u(l)},[l]),(0,n.useEffect)(()=>(i&&i.on("updateUserSocket",e=>{u(l=>l.map(l=>l.id===e.userId?(0,w.A)((0,w.A)({},l),{},{idSocketIO:e.idSocketIO}):l))}),()=>{i&&i.off("updateUserSocket")}),[i]),(0,h.jsx)(E.T,{align:"stretch",children:d&&d.length>0?d.map(e=>(0,h.jsxs)(r.a,{p:1,borderWidth:1,borderRadius:"lg",bg:"white",color:"black",children:[(0,h.jsxs)(A.E,{fontWeight:"bold",children:[e.username," ",e.surname]}),(0,h.jsx)(A.E,{children:e.email}),(0,h.jsx)(A.E,{children:e.idSocketIO}),(0,h.jsx)(E.T,{spacing:4,mb:4,children:t&&!c&&e.idSocketIO===o?(0,h.jsx)(f.$,{colorScheme:"red",leftIcon:(0,h.jsx)(O.U,{}),onClick:a,children:"End Call"}):(0,h.jsx)(U.K,{colorScheme:"blue","aria-label":"call",icon:(0,h.jsx)(y.E,{}),onClick:()=>s(e.idSocketIO)})})]},e.id)):(0,h.jsx)(A.E,{children:"No users available"})})}),R=()=>{const{stream:e,callAccepted:l,callEnded:t,callerSignal:n,myVideo:s,opponentVideo:d,callUser:u,answerCall:f,endCall:x,listUsers:j,name:g}=C();return(0,h.jsxs)(r.a,{bg:"#282c34",color:"#fff",minH:"calc=100vh-200px",py:10,children:[(0,h.jsx)(a.D,{textAlign:"center",mb:10,children:"Zoomish"}),(0,h.jsx)(c.A,{children:(0,h.jsxs)(i.s,{direction:"row",w:"full",wrap:"wrap",justifyContent:"center",children:[(0,h.jsxs)(i.s,{mb:8,position:"relative",children:[e&&(0,h.jsxs)(h.Fragment,{children:["ME",(0,h.jsx)(m,{streamRef:s,isOpponent:!1})]}),l&&!t&&(0,h.jsxs)(h.Fragment,{children:["OPP",(0,h.jsx)(m,{streamRef:d,isOpponent:!0})]})]}),(0,h.jsx)(p,{receivingCall:!!n,callAccepted:l,callEnded:t,answerCall:f,endCall:x,name:g}),(0,h.jsx)(o.h,{}),(0,h.jsx)(I,{list:j,callAccepted:l,callEnded:t,callUser:u,endCall:x})]})})]})},D=()=>(0,h.jsx)(s.A,{children:(0,h.jsx)(c.A,{children:(0,h.jsx)(r.a,{bg:"white",padding:"4",children:(0,h.jsx)(R,{})})})})},5340:()=>{},7457:()=>{}}]);
//# sourceMappingURL=878.793c0e59.chunk.js.map